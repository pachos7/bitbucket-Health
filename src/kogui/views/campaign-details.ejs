<% include ./head %>
<body>
<% include ./header %>
<main role="main" class="col-sm-9 ml-sm-auto col-md-10 pt-3">
    <% if (campaignInfo == null) { %>
       <div class="alert alert-info" role="alert">No information found for campaign: <% if (campaignName != null) { %><%= campaignName %><% } %></div>
    <% } else {  %>
        <div class="card" style="width: 40rem;">
          <div class="card-header">
          <i class="fa fa-table"></i> Campaign Details</div>
          <div class="card-body">
            <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
              <tr><td>Campaign Name</td><td><a href="/campaign/getCampaignDetails/<%= campaignInfo.CAMPAIGN_NAME %>"><%= campaignInfo.CAMPAIGN_NAME %></a></td></tr>
            <tr><td>Client Name</td><td><a href="/campaign/getAccountsByClient/<%= campaignInfo.CLIENT_NAME %>"><%= campaignInfo.CLIENT_NAME %></a></td></tr>
            <tr><td>Account</td><td><a href="/campaign/getCampaignsByAccount/<%= campaignInfo.ACCOUNT %>"><%= campaignInfo.ACCOUNT %></a></td></tr>
            <tr><td>Campaign ID</td><td><%= campaignInfo.CAMPAIGN_ID %></td></tr>
            <tr><td>Campaign Code</td><td><%= campaignInfo.CAMPAIGN_CD %></td></tr>
            <tr><td>Last Updated by</td><td><%= campaignInfo.USER_NAME %></td></tr>
            </table>
            </div>
          </div>
        </div>
        <p></p>
        <div class="card">
          <div class="card-body">
             <div class="table-responsive">
               <% if (campaignInfo.EXECUTIONS == null) { %>
                 <p>No Executions information found</p>
               <% } else {  %>
               <table class="table table-bordered table-sm" id="dataTable" width="100%" cellspacing="0">
                 <thead class="thead-light">
           	     <tr>
           	       <th>#</th>
           	       <th>Run Instance</th>
           	       <th>Environment</th>
                   <th>Status</th>
                   <th>Start</th>
                   <th>End</th>
                   <th>Duration (Hrs)</th>
                   <th>DB2 Trade Base Date</th>
                   <th>ASCEND Trade Base Date</th>
           	     </tr>
                 </thead>
                 <tbody>
                <% campaignInfo.EXECUTIONS.forEach(function(exec, i) { %>
            	<tr>
            	  <td><%= i + 1 %></td>
                <td><a href="/campaign/getRunInstanceDetails/<% if (campaignInfo.CAMPAIGN_NAME.startsWith("[UAT]")) {%>[UAT]<%}%><%= exec.RUN_INSTANCE %>"><%= exec.RUN_INSTANCE %></a></td>
                  <td><%= exec.ENVIRONMENT %></td>
                  <td> <% if (exec.STATUS == "Failed" || exec.STATUS == "Cancelled") { %> <i class="fa fa-times-circle" style="color:#FF0000;"></i>
                       <% } else if (exec.STATUS == "Success" ) { %> <i class="fa fa-check-circle" style="color:#45c10b;"></i><% }
                            else if (exec.STATUS == "Executing" ) { %> <i class="fa fa-cog" style="color:rgb(236, 195, 1)"></i><% }
                            else if (exec.STATUS == "Hold" ) { %> <i class="fa fa-hand-stop-o" style="color:rgb(153, 153, 153)"></i><% }
                            else if (exec.STATUS == "Waiting_for_Slot" ) { %> <i class="fa fa-hourglass-half" style="color:rgb(252, 110, 2)"></i><% }
                            else if (exec.STATUS == "Deliver_Hold" ) { %> <i class="fa fa-pause" style="color:rgb(224, 140, 231)"></i><% }
                            else {} %> 
                       <%= exec.STATUS %>
                  </td>
                  <%var startDate = new Date(exec.START_TS);%>
                  <td><%= startDate.toLocaleString() %></td>
                  <%if (exec.END_TS == null) {%>
                    <td>--</td>
                    <td>--</td>
                  <%} else { %>  
                    <%var endDate = new Date(exec.END_TS);%>
                    <td><%= endDate.toLocaleString() %></td>
                    <% var elapsedHrs = Math.abs(endDate - startDate) / 36e5;%>
                    <td><%=elapsedHrs.toFixed(2)%></td>   
                  <%}  %>  
                  <td><%= exec.DB2_TRADE_BASE_DT %></td>
                  <td><%= exec.ASCEND_TRADE_BASE_DT %></td>
            	</tr>
            	<% });%>
                </tbody>
              </table>            
                 <a href="/campaign/updateCampaignTableOperations/<%= campaignName %>">
                 <button class="btn btn-dark ">Get Campaign Tables Operations details</button>
                 </a>                
                <% };%>  
            </div>
          </div>
        </div>
        <a href="/campaign/updateCampaignExecutionsInfo/<%= campaignName %>">
          <button class="btn btn-dark ">Refresh Execution details</button>
        </a>
    <% } %>
  </main>
<% include ./footer %>
</body>
</html>